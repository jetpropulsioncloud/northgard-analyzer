
<div class="lore-image-container">
  <div class="gradient-bg"></div>
  <img src="assets/longhouse-icon.ico" alt="Lore Tree Background" class="lore-background">
  <div class="checkbox-grid" id="checkboxGrid"></div>
  <div class="tier-lines" id="tierLines"></div>
</div>

<style>
  .lore-image-container {
    position: relative;
    width: 500px;
    height: 350px;
    margin: 20px auto;
    border-radius: 10px;
    overflow: hidden;
    color: white
  }

  .gradient-bg {
    position: absolute;
    inset: 0;
    background: linear-gradient(to bottom right, #000000, #001f3f);
    z-index: 0;
  }

  .lore-background {
    width: 100%;
    height: 100%;
    object-fit: cover;
    border-radius: 10px;
    position: relative;
    z-index: 1;
    opacity: 0.95;
  }

  .checkbox-grid {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    z-index: 3;
  }

  .checkbox-box {
    width: 64px;
    height: 18px;
    background-color: #222;
    border: 2px solid transparent;
    border-radius: 4px;
    position: absolute;
    cursor: pointer;
    color: white;
    font-size: 11px;
    font-weight: bold;
    display: flex;
    align-items: center;
    justify-content: center;
    pointer-events: auto;
  }

  .checkbox-box.selected {
    border: 2px solid #ffda7b;
    box-shadow: 0 0 4px #ffda7b88;
    background-color: #444;
  }

  .tier-lines {
    position: absolute;
    top: 0;
    left: 133px;
    width: 143%;
    height: 100%;
    pointer-events: none;
    z-index: 2;
  }

  .tier-line {
    position: absolute;
    width: 42%;
    height: 1px;
    border-top: 2px solid gray;
  }
</style>

<script>
  const checkboxGrid = document.getElementById("checkboxGrid");
  const tierLinesContainer = document.getElementById("tierLines");
  let clickCounter = 1;

  const boxPositions = [
    { top: 55, left: 30 }, { top: 135, left: 30 }, { top: 212, left: 30 },
    { top: 30, left: 140 }, { top: 70, left: 140 }, { top: 110, left: 140 },
    { top: 150, left: 140 }, { top: 190, left: 140 }, { top: 230, left: 140 },
    { top: 30, left: 250 }, { top: 70, left: 250 }, { top: 110, left: 250 },
    { top: 150, left: 250 }, { top: 190, left: 250 }, { top: 230, left: 250 },
    { top: 30, left: 360 }, { top: 70, left: 360 }, { top: 110, left: 360 },
    { top: 150, left: 360 }, { top: 190, left: 360 }, { top: 230, left: 360 },
    // Blessings
    { top: 300, left: 100 }, { top: 300, left: 200 }, { top: 300, left: 300 }, { top: 300, left: 400 }
  ];

  const linePositions = [23, 180, 260, 100];

  boxPositions.forEach(pos => {
    const box = document.createElement('div');
    box.className = 'checkbox-box';
    box.style.top = `${pos.top}px`;
    box.style.left = `${pos.left}px`;
    checkboxGrid.appendChild(box);

    box.addEventListener('click', () => {
      if (!box.classList.contains('selected')) {
        box.textContent = clickCounter;
        box.classList.add('selected');
        clickCounter++;
      } else {
        box.textContent = "";
        box.classList.remove('selected');
        resetClickNumbers();
      }
    });
  });

  function resetClickNumbers() {
    clickCounter = 1;
    const all = document.querySelectorAll('.checkbox-box.selected');
    all.forEach(box => box.textContent = "");
    all.forEach(box => {
      box.textContent = clickCounter++;
    });
  }

  linePositions.forEach(pos => {
    const line = document.createElement("div");
    line.className = "tier-line";
    line.style.top = `${pos}px`;
    tierLinesContainer.appendChild(line);
  });
  window.getSelectedLores = function () {
      const selected = document.querySelectorAll(".checkbox-box.selected");
      return Array.from(selected).map(opt => opt.textContent.trim());
      };
      window.getSelectedLoreIndexes = function () {
      const boxes = document.querySelectorAll(".checkbox-box");
      const indexes = [];

      boxes.forEach((box, index) => {
          if (box.classList.contains("selected")) {
          indexes.push(index);
          }
      });

      return indexes;
      };
  window.setSelectedLoreIndexes = function (indexes) {
      const boxes = document.querySelectorAll(".checkbox-box");
      boxes.forEach((box, i) => {
          box.classList.remove("selected");
          box.textContent = "";
      });

      let counter = 1;
      indexes.forEach(i => {
          const box = boxes[i];
          if (box) {
          box.classList.add("selected");
          box.textContent = counter++;
          }
      });
      };
</script>
